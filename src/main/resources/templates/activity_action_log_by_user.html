<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="" lang="en">
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"></link>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"></link>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="/js/postrequest.js"></script>
    <script src="/js/getrequest.js"></script>
</head>
<body>

<div class="container">
    <h2 align="center">Add Activity Type</h2>
    <form action="/activity_type" id="actionActionForm">
        <br> <br>
        <div th:if="${!activityQuestionDTOList.isEmpty()}">
            <div th:each="activityQuestionDTO,itr:${activityQuestionDTOList}">

                <div><label th:text="${activityQuestionDTO.getActivityName()}"
                            th:value="${activityQuestionDTO.getId()}" id="activityType[${itr}]"
                            name="activityTypeId"></label>
                    <input type="text" class="form-control col-md-4" placeholder="Enter Comments" name="userAction"/>

                    <div th:if="${activityQuestionDTO.getActivityTypeId()} != '0'">
                        <div class="form-group"
                             th:if="${!activityQuestionDTO.getActivityTypeDetailsDTOList().isEmpty()}">
                            <br> <br>
                            <label>Activity Type:</label>
                            <select id="select" class="form-control" name="activityTypeDetailId">
                                <option value="">Select Activity Type</option>
                                <option th:each="activityTypeDTO : ${activityQuestionDTO.getActivityTypeDetailsDTOList()}"
                                        th:text="${activityTypeDTO.getName()}"
                                        th:value="${activityTypeDTO.getId()}"></option>
                            </select>
                        </div>
                    </div>
                    <br><br>
                </div>
            </div>
            <br>
        </div>

        <div align="center">
            <button type="submit" class="btn btn-default">Submit</button>
        </div>
    </form>
</div>
</body>
</html>

<script>

    $(document).ready(function () {

        // SUBMIT FORM
        $("#actionActionForm").submit(function (event) {
            // Prevent the form from submitting via the browser.
            event.preventDefault();
            ajaxPost();
        });


        function ajaxPost() {

            // PREPARE FORM DATA
            var formData = {
                activityTypeId: $("#activityTypeId").val(),
                activityTypeDetailId: $("#activityTypeDetailId").val(),
                userAction: $("#userAction").val()
            };

            // DO POST
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: window.location + "/activity_type",
                //data: JSON.parse(JSON.stringify(jsonArray)),
                data: JSON.stringify(formData),
                dataType: 'json',
                success: function (result) {
                    if (result.status == "Done") {
                        $("#postResultDiv").html("<p style='background-color:#7FA7B0; color:white; padding:20px 20px 20px 20px'>" +
                            "Post Successfully! <br>" + "---> Customer's Info: FirstName = " +
                            result.data.firstname + " ,LastName = " + result.data.lastname + "</p>");
                    } else {
                        $("#postResultDiv").html("<strong>Error</strong>");
                    }
                    console.log(result);
                },
                error: function (e) {
                    alert("Error!");
                    console.log("ERROR: ", e);
                }
            });

            // Reset FormData after Posting
            resetData();

        }

        function resetData() {
            $("#activityTypeId").val("");
            $("#activityTypeDetailId").val("");
            $("#userAction").val("");
        }
    })


</script>
